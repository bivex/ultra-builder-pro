# Paimon Yield Protocol - åŠŸèƒ½è¡¥å……è®¡åˆ’

## æ¦‚è¿°
è¡¥å……ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **å¤§é¢èµå›æ£€æµ‹** - WithdrawForm è°ƒç”¨åç«¯ API æ£€æµ‹
2. **CSV æŠ¥è¡¨å¯¼å‡º** - TransactionHistory å®Œæ•´åŠŸèƒ½
3. **èµå›è¯·æ±‚è¯¦æƒ…** - Pending withdrawals å®Œæ•´å±•ç¤º + å€’è®¡æ—¶
4. **ç®¡ç†å‘˜åå°** - ç®€å•ç®¡ç†é¡µé¢å¤„ç†å¤§é¢èµå›

---

## åç«¯ API å‚è€ƒ

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/withdrawals/check` | POST | æ£€æµ‹å¤§é¢èµå›ï¼Œè¿”å›ä¼˜å…ˆçº§ |
| `/api/withdrawals/request` | POST | åˆ›å»ºå¤§é¢èµå›è¯·æ±‚ |
| `/api/withdrawals/admin/pending` | GET | è·å–å¾…å¤„ç†åˆ—è¡¨ |
| `/api/withdrawals/admin/:id/status` | PATCH | æ›´æ–°çŠ¶æ€ |
| `/api/reports/export` | GET | CSV å¯¼å‡º |

---

## å®æ–½è®¡åˆ’

### Task 1: å¤§é¢èµå›æ£€æµ‹ (~1å°æ—¶)

**ä¿®æ”¹æ–‡ä»¶**: `frontend/components/WithdrawForm.tsx`

**æ–°å»ºæ–‡ä»¶**:
- `frontend/app/api/withdrawals/check/route.ts` (API ä»£ç†)

**å®ç°è¦ç‚¹**:
1. æ·»åŠ  `isLargeWithdrawal` / `largeWithdrawalInfo` çŠ¶æ€
2. åœ¨ `previewAssets` å˜åŒ–æ—¶è°ƒç”¨ `POST /api/withdrawals/check`
3. æ˜¾ç¤ºç´«è‰² VIP å¡ç‰‡ï¼ˆä¼˜å…ˆçº§ã€å¤„ç†æ—¶é—´ï¼‰
4. å¤§é¢èµå›æ—¶åŒæ—¶è°ƒç”¨åç«¯ `/api/withdrawals/request` è®°å½•

**UI ä½ç½®**: T+1 Notice ä¸Šæ–¹

---

### Task 2: CSV æŠ¥è¡¨å¯¼å‡ºå¢å¼º (~1å°æ—¶)

**ä¿®æ”¹æ–‡ä»¶**: `frontend/components/TransactionHistory.tsx`

**æ–°å»ºæ–‡ä»¶**:
- `frontend/app/api/reports/export/route.ts` (API ä»£ç†)

**å®ç°è¦ç‚¹**:
1. æ·»åŠ æŠ¥è¡¨ç±»å‹é€‰æ‹©å™¨ï¼ˆtransactions/summaryï¼‰
2. æ·»åŠ æ—¥æœŸèŒƒå›´é€‰æ‹©ï¼ˆnative date inputï¼‰
3. é‡æ„ `exportToCSV` è°ƒç”¨åç«¯ API
4. æ·»åŠ  loading çŠ¶æ€å’Œé”™è¯¯å¤„ç†
5. ä¿ç•™å‰ç«¯ fallback

---

### Task 3: Pending Withdrawals è¯¦æƒ… (~1å°æ—¶)

**ä¿®æ”¹æ–‡ä»¶**: `frontend/components/WithdrawForm.tsx`

**å®ç°è¦ç‚¹**:
1. ä½¿ç”¨ `useReadContracts` multicall è·å–æ¯ä¸ªè¯·æ±‚è¯¦æƒ…
2. è®¡ç®—å¯é¢†å–çŠ¶æ€å’Œå‰©ä½™æ—¶é—´
3. æ˜¾ç¤ºå€’è®¡æ—¶ ("Xh Xm remaining")
4. è¿›åº¦æ¡å¯è§†åŒ– (0-100%)
5. å¯é¢†å–æ—¶é«˜äº® Claim æŒ‰é’®

**æ•°æ®ç»“æ„**:
```typescript
interface WithdrawRequestDetail {
  requestId: bigint;
  shares: bigint;      // PNGY ä»½é¢
  assets: bigint;      // é¢„ä¼° USDT
  requestTime: number; // Unix timestamp
  claimed: boolean;
  // è®¡ç®—å­—æ®µ
  claimableTime: number;
  timeRemaining: string;
  progress: number;
  status: 'pending' | 'claimable' | 'claimed';
}
```

---

### Task 4: ç®¡ç†å‘˜åå°é¡µé¢ (~1å°æ—¶)

**æ–°å»ºæ–‡ä»¶**:
- `frontend/app/admin/withdrawals/page.tsx`
- `frontend/components/AdminWithdrawalList.tsx`
- `frontend/app/api/withdrawals/admin/route.ts` (API ä»£ç†)

**å®ç°è¦ç‚¹**:
1. æ˜¾ç¤ºå¾…å¤„ç†å¤§é¢èµå›åˆ—è¡¨
2. æ˜¾ç¤ºæ¯ç¬”èµå›çš„è¯¦æƒ…ï¼ˆåœ°å€ã€é‡‘é¢ã€ä¼˜å…ˆçº§ã€æ—¶é—´ï¼‰
3. æ“ä½œæŒ‰é’®ï¼šApprove / Reject
4. ç®€å•ç­›é€‰ï¼šæŒ‰çŠ¶æ€ç­›é€‰

**UI å¸ƒå±€**:
```
/admin/withdrawals
â”œâ”€ Header: "Large Withdrawal Management"
â”œâ”€ Stats: Pending(N) | Processing(N) | Completed(N)
â”œâ”€ Table:
â”‚  â”œâ”€ ID | Address | Amount | Priority | Status | Actions
â”‚  â””â”€ ... (åˆ†é¡µ)
â””â”€ ç‚¹å‡»è¡Œå±•å¼€è¯¦æƒ…
```

---

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

| æ“ä½œ | æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|------|----------|------|
| ä¿®æ”¹ | `frontend/components/WithdrawForm.tsx` | å¤§é¢æ£€æµ‹ + è¯·æ±‚è¯¦æƒ… + å€’è®¡æ—¶ |
| ä¿®æ”¹ | `frontend/components/TransactionHistory.tsx` | CSV å¯¼å‡ºå¢å¼º |
| æ–°å»º | `frontend/app/api/withdrawals/check/route.ts` | å¤§é¢æ£€æµ‹ API ä»£ç† |
| æ–°å»º | `frontend/app/api/reports/export/route.ts` | æŠ¥è¡¨å¯¼å‡º API ä»£ç† |
| æ–°å»º | `frontend/app/api/withdrawals/admin/route.ts` | ç®¡ç†å‘˜ API ä»£ç† |
| æ–°å»º | `frontend/app/admin/withdrawals/page.tsx` | ç®¡ç†å‘˜é¡µé¢ |
| æ–°å»º | `frontend/components/AdminWithdrawalList.tsx` | ç®¡ç†å‘˜åˆ—è¡¨ç»„ä»¶ |

---

## éªŒæ”¶æ ‡å‡†

- [x] è¾“å…¥ >=$100K USDT æ—¶æ˜¾ç¤º VIP å¤§é¢èµå›æç¤ºï¼ˆå«ä¼˜å…ˆçº§ï¼‰
- [x] å¤§é¢èµå›è¯·æ±‚è®°å½•åˆ°åç«¯
- [x] å¯¼å‡º CSV æ”¯æŒé€‰æ‹©æŠ¥è¡¨ç±»å‹å’Œæ—¥æœŸèŒƒå›´
- [x] Pending withdrawals æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯ï¼ˆé‡‘é¢ã€æ—¶é—´ã€å€’è®¡æ—¶ã€è¿›åº¦æ¡ï¼‰
- [x] å¯é¢†å–æ—¶ Claim æŒ‰é’®é«˜äº®
- [x] ç®¡ç†å‘˜é¡µé¢å¯æŸ¥çœ‹å¾…å¤„ç†åˆ—è¡¨
- [x] ç®¡ç†å‘˜å¯ Approve/Reject èµå›è¯·æ±‚
- [x] ç°æœ‰åŠŸèƒ½ä¸å—å½±å“

---

## çŠ¶æ€: ğŸ”§ éœ€è¦ä¿®å¤ Bug

## é¢å¤–ä¿®å¤ (UI/UX æ”¹è¿›) âœ…

### Fix 1: æŒ‰é’®åˆå¹¶ä¸é¢œè‰² âœ…
- **DepositForm.tsx**: åˆå¹¶ Approve å’Œ Deposit ä¸ºå•ä¸€æŒ‰é’®ï¼Œæ ¹æ®çŠ¶æ€åˆ‡æ¢æ–‡æœ¬
- **WithdrawForm.tsx**: æŒ‰é’®é¢œè‰²ä»æ©™è‰²æ”¹ä¸ºä¸»é¢˜è“è‰² (`--color-primary: #2563EB`)

### Fix 2: å¡ç‰‡å¯è§æ€§ (ç™½è‰²èƒŒæ™¯é€‚é…) âœ…
- **VIP å¤§é¢èµå›å¡ç‰‡**: `bg-purple-50 border-purple-200` + `text-purple-700/600/500`
- **T+1 æç¤ºå¡ç‰‡**: `bg-amber-50 border-amber-200` + `text-amber-700/600`

---

## Bug ä¿®å¤ (å¾…å¤„ç†)

### Bug 1: Admin é¡µé¢ `stats.pending` undefined
**æ–‡ä»¶**: `frontend/components/AdminWithdrawalList.tsx`
**ä½ç½®**: Line 49-51
**åŸå› **: `data.data.stats` å¯èƒ½ä¸º undefinedï¼ˆåç«¯è¿”å›æ ¼å¼ä¸ä¸€è‡´ï¼‰
**ä¿®å¤**:
```typescript
if (data.success) {
  setWithdrawals(data.data?.withdrawals || []);
  setStats(data.data?.stats || { pending: 0, processing: 0, approved: 0, rejected: 0 });
}
```

### Bug 2: å¤§é¢èµå›æ— æ³•è§¦å‘åå°è®°å½•
**æ–‡ä»¶**: `frontend/components/WithdrawForm.tsx`
**ä½ç½®**: VIP å¡ç‰‡åŒºåŸŸ (Lines 577-612)
**åŸå› **: VIP å¡ç‰‡åªæ˜¾ç¤ºä¿¡æ¯ï¼Œæ²¡æœ‰æŒ‰é’®è§¦å‘åç«¯è¯·æ±‚
**ä¿®å¤**: åœ¨ VIP å¡ç‰‡ä¸­æ·»åŠ  "Register VIP Request" æŒ‰é’®
```typescript
// åœ¨ VIP å¡ç‰‡å†…æ·»åŠ 
<button
  onClick={handleRegisterLargeWithdrawal}
  className="mt-3 w-full py-2 px-4 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors"
>
  Register VIP Request
</button>
```

**æ–°å¢å‡½æ•°**:
```typescript
const handleRegisterLargeWithdrawal = async () => {
  if (!largeWithdrawalInfo?.isLargeWithdrawal || !previewAssets || !address) return;

  try {
    const response = await fetch('/api/withdrawals/request', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        walletAddress: address,
        amount: previewAssets.toString(),
        amountUsd: largeWithdrawalInfo.amountUsd,
      }),
    });

    if (response.ok) {
      alert('VIP withdrawal request registered successfully!');
    }
  } catch (err) {
    console.error('Failed to register:', err);
  }
};
```

---

## é¢„ä¼°æ€»æ—¶é—´: ~4å°æ—¶ âœ… å·²å®Œæˆ + 30åˆ†é’Ÿ Bug ä¿®å¤

---

# VIP å¤§é¢èµå›å®Œæ•´æµç¨‹è®¾è®¡ (v2.0)

## ä¸šåŠ¡æµç¨‹å›¾

```
ç”¨æˆ·ç«¯                          åå°                         ç®¡ç†å‘˜ç«¯
  â”‚                              â”‚                              â”‚
  â–¼                              â”‚                              â”‚
[è¾“å…¥é‡‘é¢ >= $100K]              â”‚                              â”‚
  â”‚                              â”‚                              â”‚
  â–¼                              â”‚                              â”‚
[æ˜¾ç¤º VIP å¡ç‰‡]                  â”‚                              â”‚
  â”‚                              â”‚                              â”‚
  â–¼                              â”‚                              â”‚
[ç‚¹å‡» "Register VIP Request"]    â”‚                              â”‚
  â”‚                              â”‚                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                              â”‚
  â”‚                         [åˆ›å»ºè¯·æ±‚è®°å½•]                       â”‚
  â”‚                         [ç”Ÿæˆ Request ID]                   â”‚
  â”‚                         [å‘é€é€šçŸ¥ç»™ç®¡ç†å‘˜]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                              â”‚                         [æ˜¾ç¤ºæ–°è¯·æ±‚é€šçŸ¥]
  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚
  â”‚                              â”‚                              â”‚
  â–¼                              â”‚                              â”‚
[æ˜¾ç¤ºç¡®è®¤å¼¹çª—]                   â”‚                              â”‚
 - Request ID: #VIP-xxx          â”‚                              â”‚
 - çŠ¶æ€: ç­‰å¾…å®¡æ ¸                 â”‚                              â”‚
 - é¢„è®¡å¤„ç†æ—¶é—´: 4h               â”‚                              â”‚
 - ç´§æ€¥è”ç³»æ–¹å¼                   â”‚                              â”‚
  â”‚                              â”‚                              â”‚
  â”‚                              â”‚                              â–¼
  â”‚                              â”‚                         [å®¡æ ¸è¯·æ±‚]
  â”‚                              â”‚                          â”œâ”€â”€ æ‰¹å‡†
  â”‚                              â”‚                          â”œâ”€â”€ æ‹’ç»
  â”‚                              â”‚                          â””â”€â”€ è¦æ±‚è¡¥å……ä¿¡æ¯
  â”‚                              â”‚                              â”‚
  â”‚                              â”‚                              â–¼
  â”‚                         [æ›´æ–°çŠ¶æ€]â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                         [è®¾ç½®æ”¾è¡Œé¢åº¦]                       â”‚
  â”‚                         [è®¾ç½®æœ‰æ•ˆæœŸ 24h]                     â”‚
  â”‚                              â”‚                              â”‚
  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚
  â”‚                              â”‚                              â”‚
  â–¼                              â”‚                              â”‚
[æ˜¾ç¤ºå®¡æ‰¹ç»“æœé€šçŸ¥]               â”‚                              â”‚
 - âœ… å·²æ‰¹å‡†: å¯ä»¥æç°            â”‚                              â”‚
 - æœ‰æ•ˆæœŸ: 24å°æ—¶å†…               â”‚                              â”‚
 - âŒ å·²æ‹’ç»: æ˜¾ç¤ºåŸå›              â”‚                              â”‚
  â”‚                              â”‚                              â”‚
  â–¼                              â”‚                              â”‚
[æ­£å¸¸æç°æµç¨‹]                   â”‚                              â”‚
 - ç³»ç»Ÿæ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆæ‰¹å‡†         â”‚                              â”‚
 - åœ¨æœ‰æ•ˆæœŸå†…æ”¾è¡Œå¤§é¢æç°         â”‚                              â”‚
```

---

## è¯¦ç»†è®¾è®¡æ–¹æ¡ˆ

### 1. ç”¨æˆ·ç‚¹å‡» "Register VIP Request" å

**å¼¹çª—å†…å®¹è®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ“ VIP å¤§é¢èµå›ç”³è¯·å·²æäº¤               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ç”³è¯·ç¼–å·: #VIP-20231201-001            â”‚
â”‚  ç”³è¯·é‡‘é¢: $150,000 USDT                â”‚
â”‚  å½“å‰çŠ¶æ€: â³ ç­‰å¾…å®¡æ ¸                   â”‚
â”‚                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ“‹ åç»­æµç¨‹:                           â”‚
â”‚  1. æˆ‘ä»¬çš„å›¢é˜Ÿå°†åœ¨ 4 å°æ—¶å†…å®¡æ ¸æ‚¨çš„ç”³è¯·   â”‚
â”‚  2. å®¡æ ¸é€šè¿‡åï¼Œæ‚¨å°†åœ¨æ­¤é¡µé¢æ”¶åˆ°é€šçŸ¥      â”‚
â”‚  3. é€šè¿‡åè¯·åœ¨ 24 å°æ—¶å†…å®Œæˆæç°          â”‚
â”‚                                         â”‚
â”‚  ğŸ’¬ ç´§æ€¥è”ç³»:                           â”‚
â”‚  Telegram: @PaimonSupport               â”‚
â”‚  Email: vip@paimonyield.com             â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         çŸ¥é“äº†                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ç®¡ç†å‘˜å¦‚ä½•çœ‹åˆ°æ¶ˆæ¯

**æ–¹æ¡ˆ A: è½®è¯¢ + å¾½ç« é€šçŸ¥** (ç®€å•å®ç°)
- Admin é¡µé¢æ¯ 30s è½®è¯¢æ–°è¯·æ±‚
- æ˜¾ç¤ºçº¢è‰²å¾½ç« æ•°å­—

**æ–¹æ¡ˆ B: WebSocket å®æ—¶æ¨é€** (æ¨è)
- æ–°è¯·æ±‚æ—¶å®æ—¶æ¨é€åˆ°ç®¡ç†å‘˜
- æµè§ˆå™¨é€šçŸ¥ (Notification API)

**æ–¹æ¡ˆ C: å¤–éƒ¨é€šçŸ¥** (å¯é€‰å¢å¼º)
- Telegram Bot é€šçŸ¥
- Email é€šçŸ¥
- Slack/Discord é›†æˆ

### 3. å¦‚ä½•é€šçŸ¥ç”¨æˆ·å®¡æ‰¹ç»“æœ

**æ–¹æ¡ˆ A: è½®è¯¢çŠ¶æ€** (ç®€å•å®ç°)
- ç”¨æˆ·ç«¯æ¯ 30s æ£€æŸ¥è¯·æ±‚çŠ¶æ€
- çŠ¶æ€å˜æ›´æ—¶æ˜¾ç¤º Toast é€šçŸ¥

**æ–¹æ¡ˆ B: é¡µé¢å†…çŠ¶æ€æ˜¾ç¤º** (æ¨è)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VIP è¯·æ±‚çŠ¶æ€                         â”‚
â”‚                                     â”‚
â”‚ #VIP-20231201-001                   â”‚
â”‚ âœ… å·²æ‰¹å‡†                            â”‚
â”‚ æœ‰æ•ˆæœŸè‡³: 2023-12-02 18:30          â”‚
â”‚                                     â”‚
â”‚ [ç«‹å³æç°]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ–¹æ¡ˆ C: å¤–éƒ¨é€šçŸ¥** (å¯é€‰)
- Email é€šçŸ¥
- Telegram é€šçŸ¥

### 4. æ”¾è¡Œæœºåˆ¶ä¸æ—¶é—´é™åˆ¶

**æ•°æ®æ¨¡å‹æ‰©å±•**:
```typescript
interface VipWithdrawalApproval {
  id: string;
  walletAddress: string;
  requestedAmount: bigint;    // ç”³è¯·é‡‘é¢
  approvedAmount: bigint;     // æ‰¹å‡†é‡‘é¢ (å¯èƒ½è°ƒæ•´)
  status: 'pending' | 'approved' | 'rejected' | 'expired' | 'used';
  approvedAt?: Date;
  expiresAt?: Date;           // æ‰¹å‡†å 24h
  usedAt?: Date;              // å®é™…æç°æ—¶é—´
  adminNote?: string;         // ç®¡ç†å‘˜å¤‡æ³¨
  rejectionReason?: string;   // æ‹’ç»åŸå› 
}
```

**æ”¾è¡Œæ£€æŸ¥æµç¨‹**:
```typescript
// WithdrawForm ä¸­æç°å‰æ£€æŸ¥
const checkWithdrawalAllowance = async (address, amount) => {
  // 1. æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™é¢
  if (amount <= MAX_WITHDRAWAL) return { allowed: true };

  // 2. æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„ VIP æ‰¹å‡†
  const approval = await fetch(`/api/withdrawals/approval/${address}`);

  if (approval.status === 'approved' &&
      approval.expiresAt > Date.now() &&
      amount <= approval.approvedAmount) {
    return { allowed: true, approvalId: approval.id };
  }

  return { allowed: false, reason: 'No valid approval' };
};
```

### 5. ç”¨æˆ·åœ¨å“ªé‡Œæç°

**åŸä½ç½®æç°** (æ¨è):
- ç”¨æˆ·ä»åœ¨ Dashboard çš„ Withdraw è¡¨å•æç°
- ç³»ç»Ÿè‡ªåŠ¨æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆæ‰¹å‡†
- æœ‰æ‰¹å‡†åˆ™æ”¾è¡Œï¼Œæ— æ‰¹å‡†åˆ™æç¤ºéœ€è¦å…ˆç”³è¯·

**æµç¨‹å˜æ›´**:
```
åŸæµç¨‹:
è¾“å…¥é‡‘é¢ â†’ æ˜¾ç¤º VIP å¡ç‰‡ â†’ ç‚¹å‡»æç° â†’ è¢«æ‹’ç» (è¶…é™)

æ–°æµç¨‹:
è¾“å…¥é‡‘é¢ â†’ æ˜¾ç¤º VIP å¡ç‰‡ â†’ æ³¨å†Œç”³è¯· â†’ [ç­‰å¾…æ‰¹å‡†] â†’ æ‰¹å‡†åæ˜¾ç¤ºç»¿è‰²é€šçŸ¥ â†’ ç‚¹å‡»æç° â†’ æˆåŠŸ
```

---

## å®æ–½è®¡åˆ’ (Phase 2)

### Task 1: ç¡®è®¤å¼¹çª—ç»„ä»¶ (~30åˆ†é’Ÿ)
- åˆ›å»º `VipRequestModal.tsx`
- æ˜¾ç¤ºç”³è¯·è¯¦æƒ…ã€åç»­æµç¨‹ã€è”ç³»æ–¹å¼
- é›†æˆåˆ° WithdrawForm

### Task 2: çŠ¶æ€è½®è¯¢ä¸é€šçŸ¥ (~1å°æ—¶)
- WithdrawForm æ·»åŠ çŠ¶æ€è½®è¯¢ (30s)
- æ˜¾ç¤ºå½“å‰ç”³è¯·çŠ¶æ€å¡ç‰‡
- Toast é€šçŸ¥çŠ¶æ€å˜æ›´

### Task 3: æ”¾è¡Œæ£€æŸ¥é€»è¾‘ (~1å°æ—¶)
- åç«¯ API: `GET /api/withdrawals/approval/:address`
- å‰ç«¯: æç°å‰æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆæ‰¹å‡†
- æ‰¹å‡†å 24h æœ‰æ•ˆæœŸ

### Task 4: ç®¡ç†å‘˜é€šçŸ¥å¢å¼º (~30åˆ†é’Ÿ)
- æ–°è¯·æ±‚æ—¶æ˜¾ç¤ºå¾½ç« 
- æµè§ˆå™¨ Notification æé†’
- è‡ªåŠ¨åˆ·æ–°åˆ—è¡¨

### Task 5: API æ‰©å±• (~1å°æ—¶)
- æ‰©å±•åç«¯æ•°æ®æ¨¡å‹
- æ·»åŠ  expiresAt, usedAt å­—æ®µ
- æ‰¹å‡†æ—¶è®¾ç½® 24h è¿‡æœŸ

---

## ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### çŠ¶æ€å¯è§æ€§
| çŠ¶æ€ | ç”¨æˆ·çœ‹åˆ°çš„ | é¢œè‰² |
|------|-----------|------|
| å¾…å®¡æ ¸ | â³ ç­‰å¾…å®¡æ ¸ | é»„è‰² |
| å·²æ‰¹å‡† | âœ… å·²æ‰¹å‡† - 24hå†…æœ‰æ•ˆ | ç»¿è‰² |
| å·²æ‹’ç» | âŒ å·²æ‹’ç» - [åŸå› ] | çº¢è‰² |
| å·²è¿‡æœŸ | âš ï¸ å·²è¿‡æœŸ - è¯·é‡æ–°ç”³è¯· | ç°è‰² |
| å·²ä½¿ç”¨ | âœ“ å·²å®Œæˆæç° | è“è‰² |

### æ—¶é—´çº¿æ˜¾ç¤º
```
ç”³è¯·æ—¶é—´: 2023-12-01 14:30
å®¡æ ¸æ—¶é—´: 2023-12-01 15:45 (1h 15m)
æœ‰æ•ˆæœŸè‡³: 2023-12-02 15:45
çŠ¶æ€: âœ… å¯æç°
```

---

## ç¡®è®¤å‚æ•° âœ…

| é…ç½®é¡¹ | ç¡®è®¤å€¼ |
|--------|--------|
| é€šçŸ¥æ–¹å¼ | **Telegram Bot** + é¡µé¢å†…å¾½ç«  |
| æœ‰æ•ˆæœŸ | **48 å°æ—¶** |
| é‡‘é¢è°ƒæ•´ | **å¯è°ƒæ•´** (ç®¡ç†å‘˜å¯æ‰¹å‡†ä¸åŒé‡‘é¢) |
| å¤šæ¬¡ç”³è¯· | ä¸å…è®¸ (ä¸€ä¸ªåœ°å€åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªå¾…å®¡æ ¸ç”³è¯·)

---

## æœ€ç»ˆå®æ–½ä»»åŠ¡æ¸…å•

### Phase 2: VIP æµç¨‹å®Œå–„ (~4å°æ—¶)

#### Task 2.1: ç¡®è®¤å¼¹çª—ç»„ä»¶ (30åˆ†é’Ÿ)
**æ–‡ä»¶**: `frontend/components/VipRequestModal.tsx` (æ–°å»º)
- æ˜¾ç¤º Request IDã€é‡‘é¢ã€çŠ¶æ€
- åç»­æµç¨‹è¯´æ˜ (3æ­¥)
- ç´§æ€¥è”ç³»æ–¹å¼ (Telegram/Email)
- é›†æˆåˆ° WithdrawForm

#### Task 2.2: ç”¨æˆ·ç«¯çŠ¶æ€æ˜¾ç¤º (45åˆ†é’Ÿ)
**æ–‡ä»¶**: `frontend/components/WithdrawForm.tsx`
- æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰å¾…å®¡æ ¸/å·²æ‰¹å‡†çš„ç”³è¯·
- æ˜¾ç¤º VIP çŠ¶æ€å¡ç‰‡ (å¾…å®¡æ ¸/å·²æ‰¹å‡†/å·²è¿‡æœŸ)
- å·²æ‰¹å‡†æ—¶æ˜¾ç¤ºå€’è®¡æ—¶ (48h)
- çŠ¶æ€è½®è¯¢ (30ç§’)

#### Task 2.3: ç®¡ç†å‘˜é‡‘é¢è°ƒæ•´åŠŸèƒ½ (45åˆ†é’Ÿ)
**æ–‡ä»¶**: `frontend/components/AdminWithdrawalList.tsx`
- æ‰¹å‡†æ—¶å¯è¾“å…¥å®é™…æ‰¹å‡†é‡‘é¢
- æ˜¾ç¤º "ç”³è¯·é‡‘é¢" vs "æ‰¹å‡†é‡‘é¢"
- ç®¡ç†å‘˜å¤‡æ³¨å­—æ®µ

#### Task 2.4: Telegram Bot é€šçŸ¥ (1å°æ—¶)
**æ–‡ä»¶**: `backend/services/telegram.ts` (æ–°å»º)
- æ–°è¯·æ±‚æ—¶å‘é€æ¶ˆæ¯åˆ°ç®¡ç†å‘˜ç¾¤
- æ¶ˆæ¯æ ¼å¼: åœ°å€ã€é‡‘é¢ã€ä¼˜å…ˆçº§ã€æ—¶é—´
- ç¯å¢ƒå˜é‡: `TELEGRAM_BOT_TOKEN`, `TELEGRAM_ADMIN_CHAT_ID`

#### Task 2.5: æ”¾è¡Œæ£€æŸ¥ API (45åˆ†é’Ÿ)
**æ–‡ä»¶**: `frontend/app/api/withdrawals/approval/[address]/route.ts` (æ–°å»º)
- æŸ¥è¯¢ç”¨æˆ·æœ‰æ•ˆæ‰¹å‡†çŠ¶æ€
- è¿”å›: status, approvedAmount, expiresAt
- WithdrawForm æç°å‰è°ƒç”¨æ£€æŸ¥

#### Task 2.6: åç«¯æ•°æ®æ¨¡å‹æ‰©å±• (45åˆ†é’Ÿ)
**æ–‡ä»¶**: `backend/models/withdrawal.ts`
- æ·»åŠ å­—æ®µ: approvedAmount, expiresAt, usedAt, adminNote
- æ‰¹å‡†æ—¶è‡ªåŠ¨è®¾ç½® expiresAt = now + 48h
- å®šæ—¶ä»»åŠ¡: è¿‡æœŸè¯·æ±‚æ ‡è®°ä¸º expired

---

## å‰ç«¯æ–‡ä»¶å˜æ›´æ¸…å•

| æ“ä½œ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| æ–°å»º | `components/VipRequestModal.tsx` | ç”³è¯·ç¡®è®¤å¼¹çª— |
| æ–°å»º | `app/api/withdrawals/approval/[address]/route.ts` | æ‰¹å‡†çŠ¶æ€æŸ¥è¯¢ |
| ä¿®æ”¹ | `components/WithdrawForm.tsx` | VIPçŠ¶æ€æ˜¾ç¤º + è½®è¯¢ |
| ä¿®æ”¹ | `components/AdminWithdrawalList.tsx` | é‡‘é¢è°ƒæ•´ + å¤‡æ³¨ |

## åç«¯æ–‡ä»¶å˜æ›´æ¸…å•

| æ“ä½œ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| æ–°å»º | `services/telegram.ts` | Telegram Bot é€šçŸ¥ |
| ä¿®æ”¹ | `models/withdrawal.ts` | æ•°æ®æ¨¡å‹æ‰©å±• |
| ä¿®æ”¹ | `routes/withdrawals.ts` | API æ‰©å±• |

---

## çŠ¶æ€: å‡†å¤‡å®æ–½ Phase 2
